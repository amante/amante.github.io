<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Promedios de Equipos NFL ‚Äî Mod con Jugadores</title>
  <style>
    :root{--bg:#0b1220;--card:#121a2b;--muted:#7b88a8;--text:#e8eefc;--acc:#4ea1ff;--danger:#ff6b6b;--ok:#54d28a}
    *{box-sizing:border-box}
    body{margin:0;font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Noto Sans, Arial; background:linear-gradient(180deg,#0b1220,#0e1526 60%,#0b1220); color:var(--text)}
    header{padding:20px 16px; position:sticky; top:0; backdrop-filter: blur(8px); background: rgba(11,18,32,.7); border-bottom:1px solid rgba(255,255,255,.06); z-index:10}
    h1{margin:0;font-size: clamp(18px, 2.6vw, 28px); letter-spacing:.5px}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    .grid{display:grid; gap:16px}
    @media (min-width: 1100px){.grid{grid-template-columns: 420px 1fr}}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:18px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,.25)}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    .row3{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px}
    label{font-size:12px;color:var(--muted)}
    input,select{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0c1322; color:var(--text)}
    .btns{display:flex; gap:10px; flex-wrap:wrap}
    button{cursor:pointer; border:1px solid rgba(255,255,255,.08); background:#0f1730; color:var(--text); padding:10px 14px; border-radius:12px}
    button.primary{background:linear-gradient(180deg,#1f54ff,#1b46cc); border-color:#1d4ed8}
    button.ghost{background:transparent}
    button.danger{background:#2a1418; border-color:#63222a; color:#ff9aa8}
    .toolbar{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:10px; flex-wrap:wrap}
    table{width:100%; border-collapse: collapse; overflow:hidden; border-radius:14px}
    thead th{position:sticky; top:0; background:#0e172c; color:#c8d4f8; text-align:left; font-weight:600; font-size:12px; letter-spacing:.3px; padding:10px; border-bottom:1px solid rgba(255,255,255,.06); cursor:pointer}
    tbody td{padding:10px; border-bottom:1px dashed rgba(255,255,255,.06); font-size:14px; color:#e9efff}
    tbody tr:hover{background: rgba(255,255,255,.03)}
    .pill{font-size:12px; padding:4px 8px; border-radius:999px; background:#0f2038; border:1px solid rgba(255,255,255,.08)}
    footer{opacity:.7; text-align:center; padding:20px}
    .hint{color:var(--muted); font-size:12px}
    .file{display:none}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap">
      <h1>üìä Promedios de Equipos NFL ‚Äî Jugadores</h1>
      <div class="right">
        <button id="exportCSV">Exportar CSV</button>
        <label class="pill" for="importFile" style="cursor:pointer">Importar CSV</label>
        <input id="importFile" class="file" type="file" accept=".csv" />
        <button id="exportPlayers">Exportar Jugadores</button>
        <label class="pill" for="importPlayers" style="cursor:pointer">Importar Jugadores</label>
        <input id="importPlayers" class="file" type="file" accept=".csv" />
        <button id="loadPresets">Cargar Presets</button>
        <button id="clearAll" class="danger">Borrar todo</button>
      </div>
    </div>
  </header>

  <main class="container grid">
    <!-- aqu√≠ se mantienen las secciones previas (equipos, comparador, partidos) -->

    <!-- Nueva secci√≥n Jugadores -->
    <section class="card">
      <h2>Jugadores por equipo</h2>
      <p class="hint">Agrega jugadores a un equipo para ajustar el modelo.</p>
      <div class="row3">
        <div><label>Equipo</label><select id="player_team"></select></div>
        <div><label>Nombre</label><input id="player_name" /></div>
        <div><label>Posici√≥n</label><input id="player_pos" placeholder="QB, WR, RB..." /></div>
      </div>
      <div class="row3">
        <div><label>Rating (0-100)</label><input id="player_rating" type="number" min="0" max="100" /></div>
        <div><label>Uso (0-1)</label><input id="player_usage" type="number" step="0.1" min="0" max="1" /></div>
        <div><label>Estado</label>
          <select id="player_status">
            <option value="active">Activo</option>
            <option value="questionable">Dudoso</option>
            <option value="injured">Lesionado</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div><label>Tag</label><input id="player_tag" placeholder="QB1, WR1..." /></div>
      </div>
      <div class="btns" style="margin-top:10px">
        <button class="primary" id="savePlayer">Agregar / Actualizar</button>
        <button class="ghost" id="resetPlayer">Limpiar</button>
      </div>
      <div style="overflow:auto; margin-top:12px">
        <table id="playersTable">
          <thead>
            <tr><th>Equipo</th><th>Nombre</th><th>Pos</th><th>Rating</th><th>Uso</th><th>Estado</th><th>Tag</th><th>Acciones</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <small class="hint">Hecho con ‚ù§Ô∏è para fans de la NFL. ‚Äî Soporte de Jugadores incluido.</small>
  </footer>

  <script>
    // Extiende el state para jugadores
    const PLAYERS_KEY = 'nfl_players_v1';
    state.players = [];

    function loadPlayers(){
      try{ const raw = localStorage.getItem(PLAYERS_KEY); state.players = raw? JSON.parse(raw): []; }catch(e){ state.players=[]; }
    }
    function savePlayers(){ localStorage.setItem(PLAYERS_KEY, JSON.stringify(state.players)); }

    function renderPlayers(){
      const tbody = document.querySelector('#playersTable tbody');
      if(!tbody) return;
      tbody.innerHTML = state.players.map((p,i)=>`
        <tr>
          <td>${escapeHTML(getTeamById(p.team)?.team || p.team)}</td>
          <td>${escapeHTML(p.name)}</td>
          <td>${escapeHTML(p.pos)}</td>
          <td>${p.rating}</td>
          <td>${p.usage}</td>
          <td>${p.status}</td>
          <td>${escapeHTML(p.tag||'')}</td>
          <td><button onclick="delPlayer(${i})" class="danger">üóëÔ∏è</button></td>
        </tr>`).join('');
    }

    function delPlayer(i){ state.players.splice(i,1); savePlayers(); renderPlayers(); }

    document.querySelector('#savePlayer').onclick = ()=>{
      const team = document.querySelector('#player_team').value;
      const name = document.querySelector('#player_name').value;
      if(!team||!name) return alert('Equipo y nombre obligatorios');
      const obj = {
        team, name,
        pos: document.querySelector('#player_pos').value,
        rating: toNum(document.querySelector('#player_rating').value)||50,
        usage: toNum(document.querySelector('#player_usage').value)||1,
        status: document.querySelector('#player_status').value,
        tag: document.querySelector('#player_tag').value
      };
      state.players.push(obj);
      savePlayers(); renderPlayers();
    };
    document.querySelector('#resetPlayer').onclick = ()=>{
      ['player_name','player_pos','player_rating','player_usage','player_tag'].forEach(id=> document.querySelector('#'+id).value='');
    };

    // Export/Import jugadores CSV
    document.querySelector('#exportPlayers').onclick = ()=>{
      const cols = ['team','name','pos','rating','usage','status','tag'];
      const head = cols.join(',');
      const body = state.players.map(p=> cols.map(k=>p[k]).join(',')).join('\n');
      download('nfl_jugadores.csv', head+'\n'+body);
    };
    document.querySelector('#importPlayers').addEventListener('change', async (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const text = await file.text();
      const lines = text.split(/\r?\n/).filter(l=>l.trim());
      lines.shift(); // head
      for(const line of lines){
        const [team,name,pos,rating,usage,status,tag] = line.split(',');
        state.players.push({team,name,pos,rating:parseFloat(rating),usage:parseFloat(usage),status,tag});
      }
      savePlayers(); renderPlayers(); e.target.value='';
    });

    // Presets (ejemplo: Chiefs, Ravens)
    document.querySelector('#loadPresets').onclick = ()=>{
      const presets = [
        {team:'Kansas City Chiefs', name:'Patrick Mahomes', pos:'QB', rating:95, usage:0.95, status:'active', tag:'QB1'},
        {team:'Kansas City Chiefs', name:'Travis Kelce', pos:'TE', rating:92, usage:0.85, status:'active', tag:'TE1'},
        {team:'Kansas City Chiefs', name:'Marquise Brown', pos:'WR', rating:84, usage:0.75, status:'active', tag:'WR1'},
        {team:'Baltimore Ravens', name:'Lamar Jackson', pos:'QB', rating:96, usage:0.95, status:'active', tag:'QB1'},
        {team:'Baltimore Ravens', name:'Mark Andrews', pos:'TE', rating:90, usage:0.8, status:'active', tag:'TE1'}
      ];
      state.players = state.players.concat(presets);
      savePlayers(); renderPlayers();
      alert('Presets agregados');
    };

    loadPlayers(); renderPlayers();
  </script>
</body>
</html>
